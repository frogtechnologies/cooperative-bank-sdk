<?php

use FROG\CooperativeBankSdk\CooperativeBankSdk;
use FROG\PhpCurlSAI\SAI_CurlStub;

it('can get the account mini statement', function () {

    $cURL = new SAI_CurlStub();
    $sdk = new CooperativeBankSdk($cURL);

    // Setup to retrieve token successfully
    $cURL->setResponse(
        '{"access_token":"4fbb7b9e-9c73-3155-ac14-c14fe744d104","scope":"am_application_scope default","token_type":"Bearer","expires_in":3600}',
        get_valid_auth_options()
    );
    $token_result = $sdk->generate_access_token();

    $message_reference = generate_message_reference();
    $request_body = [
        'MessageReference' => $message_reference,
        'AccountNumber' => "36001873000",
        "StartDate" =>  "2020-11-12",
        "EndDate" => "2021-02-26",
    ];

    // Setup to successfully retrieve the account mini statement
    $cURL->setResponse(
        '{
            "MessageReference": "40ca18c6765086089a1",
            "MessageDateTime": "2021-02-26 11:14:14",
            "MessageCode": "0",
            "MessageDescription": "Success",
            "AccountNumber": "36001873000",
            "AccountName": "JOE K. DOE",
            "Transactions": [
              {
                "TransactionID": "b5fe2fa6-8",
                "TransactionDate": "2021-02-25 17:09:46",
                "ValueDate": "2021-02-25 17:09:46",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "ec04904f-2",
                "CreditAmount": "3742.12",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "155179.82",
                "RunningBookBalance": "155179.82",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-07 00:00:00"
              },
              {
                "TransactionID": "f575df1e-3",
                "TransactionDate": "2021-02-25 16:15:12",
                "ValueDate": "2021-02-25 16:15:12",
                "Narration": "Electricity payment",
                "TransactionType": "D",
                "ServicePoint": "POS-P0917",
                "TransactionReference": "b6ef0d3b-d",
                "CreditAmount": "0.00",
                "DebitAmount": "60270.98",
                "RunningClearedBalance": "84208.26",
                "RunningBookBalance": "84208.26",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-21 00:00:00"
              },
              {
                "TransactionID": "e316c55a-2",
                "TransactionDate": "2021-02-18 08:01:38",
                "ValueDate": "2021-02-18 08:01:38",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "2ec73ccb-d",
                "CreditAmount": "0.00",
                "DebitAmount": "72279.92",
                "RunningClearedBalance": "136996.82",
                "RunningBookBalance": "136996.82",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-15 00:00:00"
              },
              {
                "TransactionID": "0b0e399d-1",
                "TransactionDate": "2021-02-18 03:38:00",
                "ValueDate": "2021-02-18 03:38:00",
                "Narration": "Payment Received from xyz",
                "TransactionType": "C",
                "ServicePoint": "IPSL",
                "TransactionReference": "32b355d0-a",
                "CreditAmount": "53147.42",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "137355.67",
                "RunningBookBalance": "137355.67",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-12 00:00:00"
              },
              {
                "TransactionID": "81a41caa-9",
                "TransactionDate": "2021-02-15 18:13:55",
                "ValueDate": "2021-02-15 18:13:55",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "8a7fa08b-9",
                "CreditAmount": "46072.70",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "38446.55",
                "RunningBookBalance": "38446.55",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-19 00:00:00"
              },
              {
                "TransactionID": "0b88437c-7",
                "TransactionDate": "2021-02-14 11:09:27",
                "ValueDate": "2021-02-14 11:09:27",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "8cee81ee-4",
                "CreditAmount": "0.00",
                "DebitAmount": "46066.11",
                "RunningClearedBalance": "179736.25",
                "RunningBookBalance": "179736.25",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-27 00:00:00"
              },
              {
                "TransactionID": "3ff9262f-f",
                "TransactionDate": "2021-02-14 00:42:20",
                "ValueDate": "2021-02-14 00:42:20",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "b55ba4bf-c",
                "CreditAmount": "30613.14",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "102057.49",
                "RunningBookBalance": "102057.49",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-20 00:00:00"
              },
              {
                "TransactionID": "c0d680a1-e",
                "TransactionDate": "2021-02-12 18:06:24",
                "ValueDate": "2021-02-12 18:06:24",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "0d21fb6c-0",
                "CreditAmount": "64899.95",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "177796.31",
                "RunningBookBalance": "177796.31",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-19 00:00:00"
              },
              {
                "TransactionID": "abf8c76c-b",
                "TransactionDate": "2021-02-08 13:03:34",
                "ValueDate": "2021-02-08 13:03:34",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "daa499e4-f",
                "CreditAmount": "0.00",
                "DebitAmount": "56083.45",
                "RunningClearedBalance": "111500.39",
                "RunningBookBalance": "111500.39",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-17 00:00:00"
              },
              {
                "TransactionID": "10da9805-f",
                "TransactionDate": "2021-02-08 08:28:35",
                "ValueDate": "2021-02-08 08:28:35",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "59521425-0",
                "CreditAmount": "0.00",
                "DebitAmount": "79941.65",
                "RunningClearedBalance": "137032.18",
                "RunningBookBalance": "137032.18",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-25 00:00:00"
              },
              {
                "TransactionID": "76dc8e68-7",
                "TransactionDate": "2021-02-07 11:04:13",
                "ValueDate": "2021-02-07 11:04:13",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "c1966c60-1",
                "CreditAmount": "0.00",
                "DebitAmount": "54082.64",
                "RunningClearedBalance": "71444.35",
                "RunningBookBalance": "71444.35",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-05 00:00:00"
              },
              {
                "TransactionID": "87105ace-5",
                "TransactionDate": "2021-02-02 00:13:24",
                "ValueDate": "2021-02-02 00:13:24",
                "Narration": "Payment Received from xyz",
                "TransactionType": "C",
                "ServicePoint": "IPSL",
                "TransactionReference": "7f898a63-5",
                "CreditAmount": "11405.91",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "67754.20",
                "RunningBookBalance": "67754.20",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-31 00:00:00"
              },
              {
                "TransactionID": "819e0878-6",
                "TransactionDate": "2021-01-31 19:20:28",
                "ValueDate": "2021-01-31 19:20:28",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "f2a5b806-6",
                "CreditAmount": "73230.02",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "200116.38",
                "RunningBookBalance": "200116.38",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-08 00:00:00"
              },
              {
                "TransactionID": "2c0101c9-9",
                "TransactionDate": "2021-01-31 06:31:39",
                "ValueDate": "2021-01-31 06:31:39",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "5a689c5d-2",
                "CreditAmount": "11327.56",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "167583.84",
                "RunningBookBalance": "167583.84",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-29 00:00:00"
              },
              {
                "TransactionID": "7ebe524e-c",
                "TransactionDate": "2021-01-31 06:13:27",
                "ValueDate": "2021-01-31 06:13:27",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "333becdc-c",
                "CreditAmount": "0.00",
                "DebitAmount": "72236.84",
                "RunningClearedBalance": "111657.39",
                "RunningBookBalance": "111657.39",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-28 00:00:00"
              },
              {
                "TransactionID": "c9587ecb-d",
                "TransactionDate": "2021-01-30 23:49:49",
                "ValueDate": "2021-01-30 23:49:49",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "1103d962-9",
                "CreditAmount": "52898.98",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "180522.69",
                "RunningBookBalance": "180522.69",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-20 00:00:00"
              },
              {
                "TransactionID": "541e042e-a",
                "TransactionDate": "2021-01-29 11:33:29",
                "ValueDate": "2021-01-29 11:33:29",
                "Narration": "Electricity payment",
                "TransactionType": "D",
                "ServicePoint": "POS-P0917",
                "TransactionReference": "d67fdafb-d",
                "CreditAmount": "0.00",
                "DebitAmount": "50961.20",
                "RunningClearedBalance": "127623.71",
                "RunningBookBalance": "127623.71",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-24 00:00:00"
              },
              {
                "TransactionID": "fc9c649a-2",
                "TransactionDate": "2021-01-25 20:45:26",
                "ValueDate": "2021-01-25 20:45:26",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "d92096e3-2",
                "CreditAmount": "0.00",
                "DebitAmount": "67056.41",
                "RunningClearedBalance": "78937.28",
                "RunningBookBalance": "78937.28",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-18 00:00:00"
              },
              {
                "TransactionID": "d65d9a88-6",
                "TransactionDate": "2021-01-25 15:22:04",
                "ValueDate": "2021-01-25 15:22:04",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "0182638f-9",
                "CreditAmount": "0.00",
                "DebitAmount": "8401.92",
                "RunningClearedBalance": "93655.57",
                "RunningBookBalance": "93655.57",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-09 00:00:00"
              },
              {
                "TransactionID": "51aaa6cf-b",
                "TransactionDate": "2021-01-21 07:11:55",
                "ValueDate": "2021-01-21 07:11:55",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "b3f0751b-5",
                "CreditAmount": "77425.32",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "189082.71",
                "RunningBookBalance": "189082.71",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-27 00:00:00"
              },
              {
                "TransactionID": "6015add0-f",
                "TransactionDate": "2021-01-21 04:49:58",
                "ValueDate": "2021-01-21 04:49:58",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "61df8571-0",
                "CreditAmount": "0.00",
                "DebitAmount": "14845.63",
                "RunningClearedBalance": "198533.31",
                "RunningBookBalance": "198533.31",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-05 00:00:00"
              },
              {
                "TransactionID": "eafc8189-1",
                "TransactionDate": "2021-01-20 12:58:14",
                "ValueDate": "2021-01-20 12:58:14",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "61612093-6",
                "CreditAmount": "88805.54",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "225802.36",
                "RunningBookBalance": "225802.36",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-12 00:00:00"
              },
              {
                "TransactionID": "794e63ed-6",
                "TransactionDate": "2021-01-16 04:19:11",
                "ValueDate": "2021-01-16 04:19:11",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "d54e9b59-c",
                "CreditAmount": "97472.31",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "143048.51",
                "RunningBookBalance": "143048.51",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-07 00:00:00"
              },
              {
                "TransactionID": "f2c48452-0",
                "TransactionDate": "2021-01-15 01:49:44",
                "ValueDate": "2021-01-15 01:49:44",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "07294c44-3",
                "CreditAmount": "90601.60",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "13223.33",
                "RunningBookBalance": "13223.33",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-02 00:00:00"
              },
              {
                "TransactionID": "f540533e-7",
                "TransactionDate": "2021-01-14 13:47:40",
                "ValueDate": "2021-01-14 13:47:40",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "9edbdf6a-6",
                "CreditAmount": "0.00",
                "DebitAmount": "86700.23",
                "RunningClearedBalance": "56348.28",
                "RunningBookBalance": "56348.28",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-09 00:00:00"
              },
              {
                "TransactionID": "8c39316f-3",
                "TransactionDate": "2021-01-14 13:42:46",
                "ValueDate": "2021-01-14 13:42:46",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "320e4f07-e",
                "CreditAmount": "0.00",
                "DebitAmount": "41041.80",
                "RunningClearedBalance": "112896.37",
                "RunningBookBalance": "112896.37",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-02 00:00:00"
              },
              {
                "TransactionID": "0a4e3679-6",
                "TransactionDate": "2021-01-14 08:21:06",
                "ValueDate": "2021-01-14 08:21:06",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "bacd5430-7",
                "CreditAmount": "60282.60",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "153938.17",
                "RunningBookBalance": "153938.17",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-10 00:00:00"
              },
              {
                "TransactionID": "7e3b4d9a-7",
                "TransactionDate": "2021-01-12 08:44:00",
                "ValueDate": "2021-01-12 08:44:00",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "a0fd1d3a-9",
                "CreditAmount": "0.00",
                "DebitAmount": "81678.80",
                "RunningClearedBalance": "-77378.26",
                "RunningBookBalance": "-77378.26",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-02 00:00:00"
              },
              {
                "TransactionID": "439bb139-b",
                "TransactionDate": "2021-01-12 05:50:32",
                "ValueDate": "2021-01-12 05:50:32",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "dc311a85-5",
                "CreditAmount": "31470.30",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "204155.42",
                "RunningBookBalance": "204155.42",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-26 00:00:00"
              },
              {
                "TransactionID": "ba53db29-1",
                "TransactionDate": "2021-01-10 10:34:15",
                "ValueDate": "2021-01-10 10:34:15",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "0f4e5bea-f",
                "CreditAmount": "38171.93",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "236705.24",
                "RunningBookBalance": "236705.24",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-26 00:00:00"
              },
              {
                "TransactionID": "384e594a-a",
                "TransactionDate": "2021-01-08 07:15:44",
                "ValueDate": "2021-01-08 07:15:44",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "ba555065-d",
                "CreditAmount": "76077.81",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "211663.95",
                "RunningBookBalance": "211663.95",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-14 00:00:00"
              },
              {
                "TransactionID": "4138f63e-f",
                "TransactionDate": "2021-01-05 18:10:18",
                "ValueDate": "2021-01-05 18:10:18",
                "Narration": "Electricity payment",
                "TransactionType": "D",
                "ServicePoint": "POS-P0917",
                "TransactionReference": "e07d4d8d-3",
                "CreditAmount": "0.00",
                "DebitAmount": "72516.70",
                "RunningClearedBalance": "94011.04",
                "RunningBookBalance": "94011.04",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-12 00:00:00"
              },
              {
                "TransactionID": "f13d8547-1",
                "TransactionDate": "2021-01-05 17:13:16",
                "ValueDate": "2021-01-05 17:13:16",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "30285853-1",
                "CreditAmount": "0.00",
                "DebitAmount": "82082.30",
                "RunningClearedBalance": "-3093.05",
                "RunningBookBalance": "-3093.05",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-16 00:00:00"
              },
              {
                "TransactionID": "5cb527bb-c",
                "TransactionDate": "2021-01-04 07:43:04",
                "ValueDate": "2021-01-04 07:43:04",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "af2867af-9",
                "CreditAmount": "57340.81",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "144479.24",
                "RunningBookBalance": "144479.24",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-15 00:00:00"
              },
              {
                "TransactionID": "3c8b0fe1-b",
                "TransactionDate": "2021-01-04 05:07:16",
                "ValueDate": "2021-01-04 05:07:16",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "01df0057-c",
                "CreditAmount": "51.96",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "78989.25",
                "RunningBookBalance": "78989.25",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-08 00:00:00"
              },
              {
                "TransactionID": "e0a6c20f-3",
                "TransactionDate": "2021-01-02 05:35:02",
                "ValueDate": "2021-01-02 05:35:02",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "829d5754-d",
                "CreditAmount": "0.00",
                "DebitAmount": "80448.95",
                "RunningClearedBalance": "156256.29",
                "RunningBookBalance": "156256.29",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-17 00:00:00"
              },
              {
                "TransactionID": "a55f104f-5",
                "TransactionDate": "2020-12-29 14:23:03",
                "ValueDate": "2020-12-29 14:23:03",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "d9bb4da8-1",
                "CreditAmount": "68722.75",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "242644.43",
                "RunningBookBalance": "242644.43",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-16 00:00:00"
              },
              {
                "TransactionID": "9b6bd20e-a",
                "TransactionDate": "2020-12-29 10:57:25",
                "ValueDate": "2020-12-29 10:57:25",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "fefff58a-4",
                "CreditAmount": "25948.97",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "145993.69",
                "RunningBookBalance": "145993.69",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-30 00:00:00"
              },
              {
                "TransactionID": "8faf4191-3",
                "TransactionDate": "2020-12-25 23:17:17",
                "ValueDate": "2020-12-25 23:17:17",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "3da4463b-a",
                "CreditAmount": "0.00",
                "DebitAmount": "43535.74",
                "RunningClearedBalance": "24218.46",
                "RunningBookBalance": "24218.46",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-16 00:00:00"
              },
              {
                "TransactionID": "fe1c9b08-7",
                "TransactionDate": "2020-12-25 10:30:00",
                "ValueDate": "2020-12-25 10:30:00",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "51be0962-a",
                "CreditAmount": "52809.56",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "146820.60",
                "RunningBookBalance": "146820.60",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-18 00:00:00"
              },
              {
                "TransactionID": "55b1d4dd-b",
                "TransactionDate": "2020-12-25 05:51:48",
                "ValueDate": "2020-12-25 05:51:48",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "57186974-1",
                "CreditAmount": "0.00",
                "DebitAmount": "15427.68",
                "RunningClearedBalance": "196236.27",
                "RunningBookBalance": "196236.27",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-17 00:00:00"
              },
              {
                "TransactionID": "89deb6e2-3",
                "TransactionDate": "2020-12-24 18:18:00",
                "ValueDate": "2020-12-24 18:18:00",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "dbb84f63-7",
                "CreditAmount": "51402.92",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "125526.99",
                "RunningBookBalance": "125526.99",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-25 00:00:00"
              },
              {
                "TransactionID": "60edbd51-e",
                "TransactionDate": "2020-12-22 15:14:57",
                "ValueDate": "2020-12-22 15:14:57",
                "Narration": "Payment Received from xyz",
                "TransactionType": "C",
                "ServicePoint": "IPSL",
                "TransactionReference": "cf710a51-c",
                "CreditAmount": "67084.52",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "178584.91",
                "RunningBookBalance": "178584.91",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-14 00:00:00"
              },
              {
                "TransactionID": "b5a15915-c",
                "TransactionDate": "2020-12-22 00:17:55",
                "ValueDate": "2020-12-22 00:17:55",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "e8fd1852-8",
                "CreditAmount": "39964.12",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "135233.70",
                "RunningBookBalance": "135233.70",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-10 00:00:00"
              },
              {
                "TransactionID": "4e3a4be6-2",
                "TransactionDate": "2020-12-20 05:09:58",
                "ValueDate": "2020-12-20 05:09:58",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "5f6e5a4b-2",
                "CreditAmount": "0.00",
                "DebitAmount": "945.48",
                "RunningClearedBalance": "87138.43",
                "RunningBookBalance": "87138.43",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-10 00:00:00"
              },
              {
                "TransactionID": "e48eec71-3",
                "TransactionDate": "2020-12-19 02:13:35",
                "ValueDate": "2020-12-19 02:13:35",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "08d4bcf2-7",
                "CreditAmount": "7393.59",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "4300.53",
                "RunningBookBalance": "4300.53",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-11 00:00:00"
              },
              {
                "TransactionID": "e510b0fe-0",
                "TransactionDate": "2020-12-17 09:52:47",
                "ValueDate": "2020-12-17 09:52:47",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "33f1d9ad-b",
                "CreditAmount": "0.00",
                "DebitAmount": "69037.99",
                "RunningClearedBalance": "120044.72",
                "RunningBookBalance": "120044.72",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-21 00:00:00"
              },
              {
                "TransactionID": "1af3d35e-2",
                "TransactionDate": "2020-12-15 21:10:56",
                "ValueDate": "2020-12-15 21:10:56",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "cddd2e83-6",
                "CreditAmount": "65576.51",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "89794.96",
                "RunningBookBalance": "89794.96",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-10 00:00:00"
              },
              {
                "TransactionID": "1a068ee1-c",
                "TransactionDate": "2020-12-15 10:23:38",
                "ValueDate": "2020-12-15 10:23:38",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "ed10b533-4",
                "CreditAmount": "13040.47",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "209276.73",
                "RunningBookBalance": "209276.73",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-22 00:00:00"
              },
              {
                "TransactionID": "e1e57ce9-d",
                "TransactionDate": "2020-12-09 13:12:49",
                "ValueDate": "2020-12-09 13:12:49",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "43e58d71-8",
                "CreditAmount": "0.00",
                "DebitAmount": "47194.45",
                "RunningClearedBalance": "-8747.90",
                "RunningBookBalance": "-8747.90",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-14 00:00:00"
              },
              {
                "TransactionID": "888e9759-c",
                "TransactionDate": "2020-12-08 22:15:25",
                "ValueDate": "2020-12-08 22:15:25",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "76138338-5",
                "CreditAmount": "4157.99",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "183894.23",
                "RunningBookBalance": "183894.23",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-10 00:00:00"
              },
              {
                "TransactionID": "34690d52-5",
                "TransactionDate": "2020-12-08 15:39:40",
                "ValueDate": "2020-12-08 15:39:40",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "32184f8f-5",
                "CreditAmount": "0.00",
                "DebitAmount": "7241.41",
                "RunningClearedBalance": "130114.26",
                "RunningBookBalance": "130114.26",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-20 00:00:00"
              },
              {
                "TransactionID": "d73f4232-d",
                "TransactionDate": "2020-12-08 07:51:56",
                "ValueDate": "2020-12-08 07:51:56",
                "Narration": "Payment Received from xyz",
                "TransactionType": "C",
                "ServicePoint": "IPSL",
                "TransactionReference": "7b2b6d6b-4",
                "CreditAmount": "96831.80",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "88083.90",
                "RunningBookBalance": "88083.90",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-27 00:00:00"
              },
              {
                "TransactionID": "0aae6321-d",
                "TransactionDate": "2020-12-06 01:07:23",
                "ValueDate": "2020-12-06 01:07:23",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "6fe15d61-c",
                "CreditAmount": "0.00",
                "DebitAmount": "37242.70",
                "RunningClearedBalance": "162873.67",
                "RunningBookBalance": "162873.67",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-20 00:00:00"
              },
              {
                "TransactionID": "4073461d-e",
                "TransactionDate": "2020-12-04 11:36:21",
                "ValueDate": "2020-12-04 11:36:21",
                "Narration": "Electricity payment",
                "TransactionType": "D",
                "ServicePoint": "POS-P0917",
                "TransactionReference": "50d09159-e",
                "CreditAmount": "0.00",
                "DebitAmount": "69959.30",
                "RunningClearedBalance": "172685.13",
                "RunningBookBalance": "172685.13",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-23 00:00:00"
              },
              {
                "TransactionID": "5e9ea592-8",
                "TransactionDate": "2020-12-03 05:11:44",
                "ValueDate": "2020-12-03 05:11:44",
                "Narration": "Payment Received from xyz",
                "TransactionType": "C",
                "ServicePoint": "IPSL",
                "TransactionReference": "0fde036d-e",
                "CreditAmount": "23712.32",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "160744.50",
                "RunningBookBalance": "160744.50",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-20 00:00:00"
              },
              {
                "TransactionID": "f519bc1e-7",
                "TransactionDate": "2020-11-30 06:08:55",
                "ValueDate": "2020-11-30 06:08:55",
                "Narration": "Cash Withdrawal",
                "TransactionType": "D",
                "ServicePoint": "ATM-0001",
                "TransactionReference": "f46b7b8d-f",
                "CreditAmount": "0.00",
                "DebitAmount": "8347.35",
                "RunningClearedBalance": "126886.36",
                "RunningBookBalance": "126886.36",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-29 00:00:00"
              },
              {
                "TransactionID": "798c5076-7",
                "TransactionDate": "2020-11-28 13:07:41",
                "ValueDate": "2020-11-28 13:07:41",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "7f6cfa35-0",
                "CreditAmount": "0.00",
                "DebitAmount": "4173.63",
                "RunningClearedBalance": "173622.68",
                "RunningBookBalance": "173622.68",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-02-16 00:00:00"
              },
              {
                "TransactionID": "66f26975-6",
                "TransactionDate": "2020-11-26 20:24:11",
                "ValueDate": "2020-11-26 20:24:11",
                "Narration": "CASH DEPOSIT",
                "TransactionType": "C",
                "ServicePoint": "BRANCH",
                "TransactionReference": "c7ec619f-4",
                "CreditAmount": "83264.69",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "213378.94",
                "RunningBookBalance": "213378.94",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-31 00:00:00"
              },
              {
                "TransactionID": "64f5236a-b",
                "TransactionDate": "2020-11-26 08:18:36",
                "ValueDate": "2020-11-26 08:18:36",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "d9d0cd53-a",
                "CreditAmount": "0.00",
                "DebitAmount": "15670.89",
                "RunningClearedBalance": "74124.07",
                "RunningBookBalance": "74124.07",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-09 00:00:00"
              },
              {
                "TransactionID": "be2368af-8",
                "TransactionDate": "2020-11-25 06:07:42",
                "ValueDate": "2020-11-25 06:07:42",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "89f3029b-6",
                "CreditAmount": "0.00",
                "DebitAmount": "9306.80",
                "RunningClearedBalance": "151437.70",
                "RunningBookBalance": "151437.70",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-01 00:00:00"
              },
              {
                "TransactionID": "b2bea36d-c",
                "TransactionDate": "2020-11-24 23:53:09",
                "ValueDate": "2020-11-24 23:53:09",
                "Narration": "Electricity payment",
                "TransactionType": "D",
                "ServicePoint": "POS-P0917",
                "TransactionReference": "2ffa31a6-2",
                "CreditAmount": "0.00",
                "DebitAmount": "6601.01",
                "RunningClearedBalance": "173921.68",
                "RunningBookBalance": "173921.68",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-25 00:00:00"
              },
              {
                "TransactionID": "def7b1f3-e",
                "TransactionDate": "2020-11-24 06:08:09",
                "ValueDate": "2020-11-24 06:08:09",
                "Narration": "Cash Deposit",
                "TransactionType": "C",
                "ServicePoint": "AGENT-10001",
                "TransactionReference": "b8a99e9d-1",
                "CreditAmount": "43351.15",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "216973.83",
                "RunningBookBalance": "216973.83",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-12 00:00:00"
              },
              {
                "TransactionID": "749c58b9-6",
                "TransactionDate": "2020-11-19 04:00:58",
                "ValueDate": "2020-11-19 04:00:58",
                "Narration": "C2B PUSH",
                "TransactionType": "C",
                "ServicePoint": "MOBILE",
                "TransactionReference": "d58b981a-3",
                "CreditAmount": "3654.07",
                "DebitAmount": "0.00",
                "RunningClearedBalance": "166527.74",
                "RunningBookBalance": "166527.74",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-26 00:00:00"
              },
              {
                "TransactionID": "acd30ed9-5",
                "TransactionDate": "2020-11-15 16:16:27",
                "ValueDate": "2020-11-15 16:16:27",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "53c71304-2",
                "CreditAmount": "0.00",
                "DebitAmount": "11234.47",
                "RunningClearedBalance": "135586.14",
                "RunningBookBalance": "135586.14",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-11-27 00:00:00"
              },
              {
                "TransactionID": "ead5f5fc-c",
                "TransactionDate": "2020-11-13 17:28:44",
                "ValueDate": "2020-11-13 17:28:44",
                "Narration": "Payment for goods",
                "TransactionType": "D",
                "ServicePoint": "POS-P0001",
                "TransactionReference": "696da9c1-8",
                "CreditAmount": "0.00",
                "DebitAmount": "20849.48",
                "RunningClearedBalance": "-7626.15",
                "RunningBookBalance": "-7626.15",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2020-12-28 00:00:00"
              },
              {
                "TransactionID": "137ce446-a",
                "TransactionDate": "2020-11-12 08:10:14",
                "ValueDate": "2020-11-12 08:10:14",
                "Narration": "B2C PULL",
                "TransactionType": "D",
                "ServicePoint": "MOBILE",
                "TransactionReference": "0b366e92-2",
                "CreditAmount": "0.00",
                "DebitAmount": "59910.24",
                "RunningClearedBalance": "95269.58",
                "RunningBookBalance": "95269.58",
                "DebitLimit": "0.00",
                "LimitExpiryDate": "2021-01-13 00:00:00"
              }
            ]
          }',
        get_valid_req_options(
            $token_result->access_token,
            '/Enquiry/FullStatement/Account/1.0.0',
            $request_body,
        )
    );

    $result = $sdk->get_account_mini_statement(
        $token_result->access_token,
        $message_reference,
        "36001873000",
        "2020-11-12",
        "2021-02-26",
    );

    confirm_standard_response($result);
    expect($result)->toHaveProperty('AccountNumber');
    expect($result)->toHaveProperty('AccountName');
    expect($result)->toHaveProperty('Transactions');
    expect($result->Transactions)->toBeArray();
});


it('fails if the date range is more than 6 months from the current date', function () {
    $cURL = new SAI_CurlStub();
    $sdk = new CooperativeBankSdk($cURL);

    // Setup to retrieve token successfully
    $cURL->setResponse(
        '{"access_token":"4fbb7b9e-9c73-3155-ac14-c14fe744d104","scope":"am_application_scope default","token_type":"Bearer","expires_in":3600}',
        get_valid_auth_options()
    );
    $token_result = $sdk->generate_access_token();

    $message_reference = generate_message_reference();
    $request_body = [
        'MessageReference' => $message_reference,
        'AccountNumber' => "36001873000",
        "StartDate" =>  "2020-08-12",
        "EndDate" => "2020-11-12",
    ];

    // Setup to successfully retrieve the account mini statement
    $cURL->setResponse(
        '{
            "MessageReference": "40ca18c6765086089a1",
            "MessageDateTime": "2021-02-26 11:16:12",
            "MessageCode": "-17",
            "MessageDescription": "START DATE SHOULD BE WITHIN SIX MONTHS FROM CURRENT DATE"
        }',
        get_valid_req_options(
            $token_result->access_token,
            '/Enquiry/FullStatement/Account/1.0.0',
            $request_body,
        )
    );

    $result = $sdk->get_account_mini_statement(
        $token_result->access_token,
        $message_reference,
        "36001873000",
        "2020-08-12",
        "2020-11-12",
    );

    confirm_standard_response($result);
});
